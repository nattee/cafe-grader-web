- section_names = { 'chula' => 'Identity & Authentication', 'right' => 'Permissions & Access', 'system' => 'System Parameters' }
- section_icons = { 'chula' => 'fingerprint', 'right' => 'lock', 'system' => 'settings' }

.row.mb-4
  .col-md-12.d-flex.justify-content-between.align-items-center
    %h1.mb-0 System configuration
    .actions
      = link_to reload_grader_configuration_index_path, class: 'btn btn-outline-secondary btn-sm me-2', title: 'Reload configuration from DB' do
        %span.mi.md-18.mi-bs refresh
        Reload
      = link_to clear_user_ip_grader_configuration_index_path, class: 'btn btn-outline-danger btn-sm', data: {turbo: true, 'turbo-method': 'post'}, title: 'Clear all user device locks' do
        %span.mi.md-18.mi-bs lock_open
        Clear Device Locks

.row
  .col-md-12
    .config-search-wrapper
      .input-group
        %span.input-group-text
          %span.mi search
        %input#config-search.form-control{type: 'text', placeholder: 'Search for settings...', onkeyup: 'filterConfigs()'}

= turbo_frame_tag "stream_js"

.row
  - @group.each do |group|
    .col-lg-6.col-xl-4
      .card.config-card{data: {group: group}}
        .card-header
          %h3
            %span.mi= section_icons[group] || 'settings'
            = section_names[group] || group.upcase
        .card-body
          - @configurations.each do |conf|
            - next if conf.key[0...(conf.key.index('.'))] != group
            .config-item{data: {key: conf.key, search: "#{conf.key} #{conf.description}".downcase}}
              .config-main
                .config-info
                  %span.config-key= conf.key
                  .config-description= conf.description
                  %span.config-type-badge= conf.value_type
                .config-value-wrapper
                  = render partial: 'config', locals: {conf: conf}

:javascript
  function filterConfigs() {
    let input = document.getElementById('config-search');
    let filter = input.value.toLowerCase();
    let cards = document.querySelectorAll('.config-card');
    let items = document.querySelectorAll('.config-item');

    items.forEach(item => {
      let text = item.getAttribute('data-search');
      if (text.includes(filter)) {
        item.style.display = 'flex';
      } else {
        item.style.display = 'none';
      }
    });

    cards.forEach(card => {
      let visibleItems = card.querySelectorAll('.config-item[style="display: flex;"]');
      let allItems = card.querySelectorAll('.config-item');
      // if allItems has any item with style display not none
      let hasVisible = false;
      allItems.forEach(i => { if (i.style.display !== 'none') hasVisible = true; });

      if (hasVisible) {
        card.closest('.col-lg-6').style.display = 'block';
      } else {
        card.closest('.col-lg-6').style.display = 'none';
      }
    });
  }
